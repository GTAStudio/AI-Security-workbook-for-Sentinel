
{
    "version": "Notebook/1.0",
    "items": [
        {
            "type": 1,
            "content": {
                "json": "<div style='background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); color: white; margin-bottom: 15px;'>\n\n# ğŸ’» Azure Virtual Desktop è®¿é—®ç›‘æ§\n\n<div style='font-size: 14px; opacity: 0.95; margin-top: 8px;'>\nå…¨é¢ç›‘æ§ AVD è®¿é—®è¡Œä¸ºã€å®‰å…¨æ€åŠ¿ã€ç”¨æˆ·æ´»åŠ¨å’Œè®¾å¤‡åˆè§„æ€§\n</div>\n\n</div>"
            },
            "name": "title",
            "id": "161f8ed6-9fa0-4a6e-92cd-ee3d94d46de7"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "parameters": [
                    {
                        "id": "timeRange",
                        "version": "KqlParameterItem/1.0",
                        "name": "TimeRange",
                        "label": "æ—¶é—´èŒƒå›´",
                        "type": 4,
                        "isRequired": true,
                        "value": {
                            "durationMs": 2592000000
                        },
                        "typeSettings": {
                            "selectableValues": [
                                {
                                    "durationMs": 300000
                                },
                                {
                                    "durationMs": 900000
                                },
                                {
                                    "durationMs": 1800000
                                },
                                {
                                    "durationMs": 3600000
                                },
                                {
                                    "durationMs": 14400000
                                },
                                {
                                    "durationMs": 43200000
                                },
                                {
                                    "durationMs": 86400000
                                },
                                {
                                    "durationMs": 172800000
                                },
                                {
                                    "durationMs": 259200000
                                },
                                {
                                    "durationMs": 604800000
                                },
                                {
                                    "durationMs": 1209600000
                                },
                                {
                                    "durationMs": 2419200000
                                },
                                {
                                    "durationMs": 2592000000
                                },
                                {
                                    "durationMs": 5184000000
                                },
                                {
                                    "durationMs": 7776000000
                                }
                            ],
                            "allowCustom": true
                        }
                    },
                    {
                        "id": "workspace",
                        "version": "KqlParameterItem/1.0",
                        "name": "Workspace",
                        "label": "å·¥ä½œåŒº",
                        "type": 5,
                        "isRequired": true,
                        "query": "resources\n| where type == 'microsoft.operationalinsights/workspaces'\n| project id, name\n| sort by name asc",
                        "crossComponentResources": [
                            "value::all"
                        ],
                        "value": "/subscriptions/39c4d6ba-bd22-45fa-abbc-bd025e035ae5/resourceGroups/Sentinel/providers/Microsoft.OperationalInsights/workspaces/Sentinel",
                        "typeSettings": {
                            "resourceTypeFilter": {
                                "microsoft.operationalinsights/workspaces": true
                            },
                            "additionalResourceOptions": [
                                "value::1"
                            ],
                            "showDefault": false
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                        "id": "department",
                        "version": "KqlParameterItem/1.0",
                        "name": "Department",
                        "label": "éƒ¨é—¨ç­›é€‰",
                        "type": 2,
                        "isRequired": false,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| extend DeptFromEmail = split(UserPrincipalName, \"@\")[0]\n| extend Department = case(\n    DeptFromEmail contains \"hr\" or DeptFromEmail contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n    DeptFromEmail contains \"it\" or DeptFromEmail contains \"tech\", \"ITéƒ¨\",\n    DeptFromEmail contains \"sales\" or DeptFromEmail contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n    DeptFromEmail contains \"finance\" or DeptFromEmail contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n    DeptFromEmail contains \"marketing\" or DeptFromEmail contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n    DeptFromEmail contains \"ops\" or DeptFromEmail contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n    \"å…¶ä»–éƒ¨é—¨\"\n)\n| distinct Department\n| order by Department asc",
                        "crossComponentResources": [
                            "{Workspace}"
                        ],
                        "value": [
                            "value::all"
                        ],
                        "typeSettings": {
                            "additionalResourceOptions": [
                                "value::all"
                            ],
                            "showDefault": false
                        },
                        "timeContext": {
                            "durationMs": 0
                        },
                        "timeContextFromParameter": "TimeRange",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                    }
                ],
                "style": "pills"
            },
            "name": "parameters",
            "id": "8baedce7-11bb-4ac9-9beb-3c5ab067cda2"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background: linear-gradient(135deg, #e8f4f8 0%, #d4e9f7 100%); padding: 20px; border-left: 5px solid #0078d4; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,120,212,0.1);'>\n\n## ğŸ“Š å…³é”®æŒ‡æ ‡ä»ªè¡¨ç›˜\n\nå®æ—¶ç›‘æ§ AVD ç¯å¢ƒçš„æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡å’Œå¥åº·çŠ¶æ€\n\n</div>"
            },
            "name": "text - metrics header",
            "id": "7aa333fb-00f5-49c7-b5f4-83e6b42136da"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| summarize \n    TotalConnections = count(),\n    UniqueUsers = dcount(UserPrincipalName),\n    SuccessfulConnections = countif(ResultType == 0),\n    FailedConnections = countif(ResultType != 0)\n| extend SuccessRate = round(SuccessfulConnections * 100.0 / TotalConnections, 2)\n| project TotalConnections, UniqueUsers, SuccessRate, FailedConnections",
                "size": 3,
                "title": "ğŸ“Š è®¿é—®ç»Ÿè®¡",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "showBorder": false
                }
            },
            "customWidth": "50",
            "name": "query - overview metrics",
            "id": "94cf391e-4e4a-4a79-9448-88b6620adcda"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SecurityAlert\n| where ProviderName contains \"AVD\" or ProviderName contains \"Virtual Desktop\" or AlertName contains \"Remote Desktop\"\n| summarize \n    TotalAlerts = count(),\n    HighSeverity = countif(AlertSeverity == \"High\"),\n    MediumSeverity = countif(AlertSeverity == \"Medium\"),\n    LowSeverity = countif(AlertSeverity == \"Low\")\n| extend RiskScore = (HighSeverity * 10 + MediumSeverity * 5 + LowSeverity * 1)\n| project RiskScore, TotalAlerts, HighSeverity, MediumSeverity",
                "size": 3,
                "title": "ğŸ”’ å®‰å…¨é£é™©",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "tiles",
                "tileSettings": {
                    "showBorder": false
                }
            },
            "customWidth": "50",
            "name": "query - security metrics",
            "id": "1cff3242-2915-4fc5-b51f-83ef1c2ee227"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background-color: #f0f9ff; padding: 15px; border-left: 5px solid #2b88d8; border-radius: 5px; margin: 20px 0;'>\n\n## ğŸ“ˆ è®¿é—®è¶‹åŠ¿åˆ†æ\n\næŒ‰å°æ—¶/å¤©/å‘¨/æœˆæŸ¥çœ‹è¿æ¥è¶‹åŠ¿ï¼Œè¯†åˆ«è®¿é—®æ¨¡å¼å’Œå¼‚å¸¸æ³¢åŠ¨\n\n</div>"
            },
            "name": "text - trends header",
            "id": "b05f3788-cd51-43e1-83ff-24fc87d6a596"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-left: 5px solid #f57c00; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 8px rgba(245,124,0,0.1);'>\n\n## ğŸ¢ éƒ¨é—¨ AVD ä½¿ç”¨åˆ†æ\n\nä»å¤šä¸ªç»´åº¦æ·±å…¥åˆ†æå„éƒ¨é—¨çš„ AVD ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ä½¿ç”¨é‡ã€è®¾å¤‡åˆè§„æ€§ã€å®‰å…¨é£é™©ç­‰\n\n</div>"
            },
            "name": "text - department header",
            "id": "dept-header-001"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨ä½¿ç”¨æ¦‚è§ˆ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize \n    TotalConnections = count(),\n    UniqueUsers = dcount(UserPrincipalName),\n    AvgConnectionsPerUser = round(count() * 1.0 / dcount(UserPrincipalName), 2),\n    LastAccessTime = max(TimeGenerated)\n    by Department\n| order by TotalConnections desc",
                "size": 0,
                "title": "ğŸ“Š éƒ¨é—¨ AVD ä½¿ç”¨æ€»è§ˆ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "TotalConnections",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "blue"
                            }
                        },
                        {
                            "columnMatch": "UniqueUsers",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "green"
                            }
                        }
                    ]
                }
            },
            "name": "query - department overview",
            "id": "dept-query-001"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨è¿æ¥æ•°åˆ†å¸ƒ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize ConnectionCount = count() by Department\n| order by ConnectionCount desc",
                "size": 0,
                "title": "éƒ¨é—¨è¿æ¥æ•°å æ¯”",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "piechart"
            },
            "customWidth": "50",
            "name": "query - department distribution",
            "id": "dept-query-002"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨ç”¨æˆ·æ•°è¶‹åŠ¿\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize UniqueUsers = dcount(UserPrincipalName) by Department, bin(TimeGenerated, 1d)\n| order by TimeGenerated asc",
                "size": 0,
                "title": "éƒ¨é—¨æ´»è·ƒç”¨æˆ·æ•°è¶‹åŠ¿",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "linechart"
            },
            "customWidth": "50",
            "name": "query - department user trend",
            "id": "dept-query-003"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨è®¾å¤‡åˆè§„æ€§åˆ†æ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| extend \n    IsCompliant = tobool(DeviceDetail.isCompliant),\n    IsManaged = tobool(DeviceDetail.isManaged)\n| extend ComplianceStatus = case(\n    IsManaged == true and IsCompliant == true, \"åˆè§„\",\n    IsManaged == true and IsCompliant != true, \"ä¸åˆè§„\",\n    IsManaged == true, \"å·²ç®¡ç†\",\n    \"æœªç®¡ç†\"\n)\n| summarize \n    TotalDevices = count(),\n    CompliantDevices = countif(ComplianceStatus == \"åˆè§„\"),\n    NonCompliantDevices = countif(ComplianceStatus == \"ä¸åˆè§„\"),\n    UnmanagedDevices = countif(ComplianceStatus == \"æœªç®¡ç†\")\n    by Department\n| extend ComplianceRate = round(CompliantDevices * 100.0 / TotalDevices, 2)\n| order by ComplianceRate asc",
                "size": 0,
                "title": "ğŸ” éƒ¨é—¨è®¾å¤‡åˆè§„æ€§åˆ†æ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "ComplianceRate",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "greenRed",
                                "aggregation": "Average"
                            }
                        },
                        {
                            "columnMatch": "NonCompliantDevices",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "red"
                            }
                        },
                        {
                            "columnMatch": "UnmanagedDevices",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "orange"
                            }
                        }
                    ]
                }
            },
            "name": "query - department compliance",
            "id": "dept-query-004"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨å®‰å…¨é£é™©è¯„åˆ†\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\n// å¤±è´¥ç™»å½•\nlet FailedLogins = SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType != 0\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize FailedCount = count() by Department;\n// å‘¨æœ«è®¿é—®\nlet WeekendAccess = SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend DayOfWeek = dayofweek(TimeGenerated)\n| where DayOfWeek == 0d or DayOfWeek == 6d\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize WeekendCount = count() by Department;\n// éåˆè§„è®¾å¤‡\nlet NonCompliantDevices = SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| where tobool(DeviceDetail.isCompliant) != true\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize NonCompliantCount = count() by Department;\n// åˆå¹¶æ•°æ®è®¡ç®—é£é™©è¯„åˆ†\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize TotalConnections = count() by Department\n| join kind=leftouter (FailedLogins) on Department\n| join kind=leftouter (WeekendAccess) on Department\n| join kind=leftouter (NonCompliantDevices) on Department\n| extend \n    FailedCount = iff(isempty(FailedCount), 0, FailedCount),\n    WeekendCount = iff(isempty(WeekendCount), 0, WeekendCount),\n    NonCompliantCount = iff(isempty(NonCompliantCount), 0, NonCompliantCount)\n| extend RiskScore = round(\n    (FailedCount * 1.0 / TotalConnections * 100 * 3) + \n    (WeekendCount * 1.0 / TotalConnections * 100 * 1) + \n    (NonCompliantCount * 1.0 / TotalConnections * 100 * 2), 2)\n| project Department, TotalConnections, FailedCount, WeekendCount, NonCompliantCount, RiskScore\n| order by RiskScore desc",
                "size": 0,
                "title": "âš ï¸ éƒ¨é—¨å®‰å…¨é£é™©è¯„åˆ†",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "RiskScore",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "redGreen",
                                "aggregation": "Average"
                            }
                        },
                        {
                            "columnMatch": "FailedCount",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "red"
                            }
                        }
                    ]
                }
            },
            "name": "query - department risk score",
            "id": "dept-query-005"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿåˆ†å¸ƒ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| extend RawOS = tostring(DeviceDetail.operatingSystem)\n| extend ClientOS = case(\n    RawOS contains \"Windows\", \"Windows\",\n    RawOS contains \"Mac\", \"macOS\",\n    RawOS contains \"iOS\", \"iOS\",\n    RawOS contains \"Android\", \"Android\",\n    RawOS contains \"Linux\", \"Linux\",\n    \"Other\"\n)\n| summarize ConnectionCount = count() by Department, ClientOS\n| order by Department asc, ConnectionCount desc",
                "size": 0,
                "title": "ğŸ’» éƒ¨é—¨ä½¿ç”¨çš„å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿåˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "barchart",
                "chartSettings": {
                    "xAxis": "Department",
                    "yAxis": [
                        "ConnectionCount"
                    ],
                    "group": "ClientOS",
                    "createOtherGroup": 10
                }
            },
            "customWidth": "50",
            "name": "query - department os",
            "id": "dept-query-006"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨è®¿é—®æ—¶æ®µåˆ†å¸ƒ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| extend Hour = hourofday(TimeGenerated)\n| extend TimeSlot = case(\n    Hour >= 0 and Hour < 6, \"00:00-06:00 (æ·±å¤œ)\",\n    Hour >= 6 and Hour < 9, \"06:00-09:00 (æ—©æ™¨)\",\n    Hour >= 9 and Hour < 12, \"09:00-12:00 (ä¸Šåˆ)\",\n    Hour >= 12 and Hour < 14, \"12:00-14:00 (åˆä¼‘)\",\n    Hour >= 14 and Hour < 18, \"14:00-18:00 (ä¸‹åˆ)\",\n    Hour >= 18 and Hour < 22, \"18:00-22:00 (å‚æ™š)\",\n    \"22:00-00:00 (å¤œé—´)\"\n)\n| summarize ConnectionCount = count() by Department, TimeSlot\n| order by Department asc",
                "size": 0,
                "title": "ğŸ• éƒ¨é—¨è®¿é—®æ—¶æ®µåˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "barchart",
                "chartSettings": {
                    "xAxis": "Department",
                    "yAxis": [
                        "ConnectionCount"
                    ],
                    "group": "TimeSlot"
                }
            },
            "customWidth": "50",
            "name": "query - department time distribution",
            "id": "dept-query-007"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨è®¾å¤‡ç®¡ç†çŠ¶æ€ï¼ˆåŸºäº SigninLogs ä¸­çš„è®¾å¤‡ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| extend \n    IsCompliant = tobool(DeviceDetail.isCompliant),\n    IsManaged = tobool(DeviceDetail.isManaged),\n    OS = tostring(DeviceDetail.operatingSystem)\n| summarize \n    TotalConnections = count(),\n    CompliantConnections = countif(IsCompliant == true),\n    NonCompliantConnections = countif(IsCompliant == false),\n    UnknownCompliance = countif(isnull(IsCompliant)),\n    ManagedConnections = countif(IsManaged == true),\n    UnmanagedConnections = countif(IsManaged == false or isnull(IsManaged)),\n    WindowsConnections = countif(OS contains \"Windows\"),\n    MacConnections = countif(OS contains \"Mac\"),\n    MobileConnections = countif(OS contains \"iOS\" or OS contains \"Android\")\n    by Department\n| extend \n    ComplianceRate = round(CompliantConnections * 100.0 / TotalConnections, 2),\n    ManagedRate = round(ManagedConnections * 100.0 / TotalConnections, 2)\n| order by TotalConnections desc",
                "size": 0,
                "title": "ğŸ“± éƒ¨é—¨è®¾å¤‡ç®¡ç†çŠ¶æ€",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "ComplianceRate",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "greenRed"
                            }
                        },
                        {
                            "columnMatch": "ManagedRate",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "blue"
                            }
                        }
                    ]
                }
            },
            "name": "query - department intune devices",
            "id": "dept-query-008"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨åœ°ç†ä½ç½®åˆ†å¸ƒ\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| where isnotempty(Location)\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize \n    ConnectionCount = count(),\n    UniqueUsers = dcount(UserPrincipalName),\n    Departments = make_set(Department)\n    by Location\n| order by ConnectionCount desc\n| take 20",
                "size": 0,
                "title": "ğŸŒ éƒ¨é—¨ç”¨æˆ·åœ°ç†ä½ç½®åˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "map",
                "mapSettings": {
                    "locInfo": "CountryRegion",
                    "locInfoColumn": "Location",
                    "sizeSettings": "ConnectionCount",
                    "sizeAggregation": "Sum",
                    "legendMetric": "ConnectionCount",
                    "legendAggregation": "Sum",
                    "itemColorSettings": {
                        "nodeColorField": "ConnectionCount",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                    }
                }
            },
            "name": "query - department locations",
            "id": "dept-query-009"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨åº”ç”¨ä½¿ç”¨æ¨¡å¼ï¼ˆå¦‚æœæ²¡æœ‰ IntuneAuditLogs åˆ™è·³è¿‡æ­¤æŸ¥è¯¢ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize \n    UniqueApps = dcount(AppDisplayName),\n    TotalSessions = count(),\n    UniqueUsers = dcount(UserPrincipalName)\n    by Department\n| order by TotalSessions desc",
                "size": 0,
                "title": "ğŸ“² éƒ¨é—¨åº”ç”¨ç®¡ç†æ´»åŠ¨ (Intune)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table"
            },
            "customWidth": "50",
            "name": "query - department app usage",
            "id": "dept-query-010"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éƒ¨é—¨å¹³å‡è¿æ¥æˆåŠŸç‡\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| extend Department = GetDepartment(UserPrincipalName)\n| where \"*\" in ({Department}) or Department in ({Department})\n| summarize \n    TotalAttempts = count(),\n    SuccessfulConnections = countif(ResultType == 0),\n    FailedConnections = countif(ResultType != 0)\n    by Department\n| extend SuccessRate = round(SuccessfulConnections * 100.0 / TotalAttempts, 2)\n| project Department, TotalAttempts, SuccessfulConnections, FailedConnections, SuccessRate\n| order by SuccessRate asc",
                "size": 0,
                "title": "âœ… éƒ¨é—¨è¿æ¥æˆåŠŸç‡",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "barchart",
                "chartSettings": {
                    "xAxis": "Department",
                    "yAxis": [
                        "SuccessRate"
                    ],
                    "seriesLabelSettings": [
                        {
                            "seriesName": "SuccessRate",
                            "label": "æˆåŠŸç‡ (%)",
                            "color": "green"
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - department success rate",
            "id": "dept-query-011"
        },
        {
            "type": 9,
            "content": {
                "version": "KqlParameterItem/1.0",
                "parameters": [
                    {
                        "id": "trendView",
                        "version": "KqlParameterItem/1.0",
                        "name": "TrendView",
                        "label": "æŸ¥çœ‹æ–¹å¼",
                        "type": 2,
                        "isRequired": true,
                        "value": "hourly",
                        "typeSettings": {
                            "additionalResourceOptions": [],
                            "showDefault": false
                        },
                        "jsonData": "[{\"value\":\"hourly\",\"label\":\"æŒ‰å°æ—¶\",\"selected\":true},{\"value\":\"daily\",\"label\":\"æŒ‰å¤©\"},{\"value\":\"weekly\",\"label\":\"æŒ‰å‘¨\"},{\"value\":\"monthly\",\"label\":\"æŒ‰æœˆ\"}]"
                    }
                ],
                "style": "pills"
            },
            "name": "trend view parameters",
            "id": "139be9f2-2a76-43e6-b45f-d64b788c87cb"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let viewType = \"{TrendView}\";\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| summarize \n    Connections = count(),\n    UniqueUsers = dcount(UserPrincipalName),\n    SuccessfulConnections = countif(ResultType == 0),\n    FailedConnections = countif(ResultType != 0)\n    by TimeGenerated = case(\n        viewType == \"hourly\", bin(TimeGenerated, 1h),\n        viewType == \"daily\", bin(TimeGenerated, 1d),\n        viewType == \"weekly\", startofweek(TimeGenerated),\n        viewType == \"monthly\", startofmonth(TimeGenerated),\n        bin(TimeGenerated, 1d)\n    )\n| order by TimeGenerated asc",
                "size": 0,
                "title": "è®¿é—®è¶‹åŠ¿ - æ€»è§ˆï¼ˆè¿æ¥æ¬¡æ•° & ç”¨æˆ·æ•°ï¼‰",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "timechart",
                "chartSettings": {
                    "showLegend": true,
                    "seriesLabelSettings": [
                        {
                            "seriesName": "Connections",
                            "label": "è¿æ¥æ¬¡æ•°",
                            "color": "blue"
                        },
                        {
                            "seriesName": "UniqueUsers",
                            "label": "ç‹¬ç«‹ç”¨æˆ·æ•°",
                            "color": "green"
                        },
                        {
                            "seriesName": "SuccessfulConnections",
                            "label": "æˆåŠŸè¿æ¥",
                            "color": "greenDark"
                        },
                        {
                            "seriesName": "FailedConnections",
                            "label": "å¤±è´¥è¿æ¥",
                            "color": "redBright"
                        }
                    ],
                    "ySettings": {
                        "numberFormatSettings": {
                            "unit": 0,
                            "options": {
                                "style": "decimal",
                                "useGrouping": true
                            }
                        }
                    }
                }
            },
            "name": "query - connections trend",
            "id": "ec8c215b-95b9-46ea-8aa7-ac35d13fdf96"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let viewType = \"{TrendView}\";\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| summarize \n    SuccessfulConnections = countif(ResultType == 0),\n    FailedConnections = countif(ResultType != 0),\n    TotalConnections = count()\n    by TimeGenerated = case(\n        viewType == \"hourly\", bin(TimeGenerated, 1h),\n        viewType == \"daily\", bin(TimeGenerated, 1d),\n        viewType == \"weekly\", startofweek(TimeGenerated),\n        viewType == \"monthly\", startofmonth(TimeGenerated),\n        bin(TimeGenerated, 1d)\n    )\n| extend SuccessRate = round(SuccessfulConnections * 100.0 / TotalConnections, 2)\n| project TimeGenerated, SuccessfulConnections, FailedConnections, SuccessRate\n| order by TimeGenerated asc",
                "size": 0,
                "title": "è¿æ¥æˆåŠŸç‡è¶‹åŠ¿",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "linechart",
                "chartSettings": {
                    "showLegend": true,
                    "yAxis": [
                        "SuccessfulConnections",
                        "FailedConnections"
                    ],
                    "seriesLabelSettings": [
                        {
                            "seriesName": "SuccessfulConnections",
                            "label": "æˆåŠŸè¿æ¥",
                            "color": "green"
                        },
                        {
                            "seriesName": "FailedConnections",
                            "label": "å¤±è´¥è¿æ¥",
                            "color": "red"
                        },
                        {
                            "seriesName": "SuccessRate",
                            "label": "æˆåŠŸç‡ (%)",
                            "color": "blue"
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - success rate trend",
            "id": "62c9032a-6cd2-4210-8368-8c5acb0b9da1"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "let viewType = \"{TrendView}\";\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| summarize \n    UniqueUsers = dcount(UserPrincipalName)\n    by TimeGenerated = case(\n        viewType == \"hourly\", bin(TimeGenerated, 1h),\n        viewType == \"daily\", bin(TimeGenerated, 1d),\n        viewType == \"weekly\", startofweek(TimeGenerated),\n        viewType == \"monthly\", startofmonth(TimeGenerated),\n        bin(TimeGenerated, 1d)\n    )\n| order by TimeGenerated asc",
                "size": 0,
                "title": "ç‹¬ç«‹ç”¨æˆ·æ•°è¶‹åŠ¿",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "areachart",
                "chartSettings": {
                    "showLegend": true,
                    "seriesLabelSettings": [
                        {
                            "seriesName": "UniqueUsers",
                            "label": "ç‹¬ç«‹ç”¨æˆ·æ•°",
                            "color": "purple"
                        }
                    ],
                    "ySettings": {
                        "numberFormatSettings": {
                            "unit": 0,
                            "options": {
                                "style": "decimal",
                                "useGrouping": true
                            }
                        },
                        "min": 0
                    }
                }
            },
            "customWidth": "50",
            "name": "query - unique users trend",
            "id": "b258056b-08b4-4edd-9121-b652ba045a67"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background-color: #fff4e6; padding: 15px; border-left: 5px solid #ff8c00; border-radius: 5px; margin: 20px 0;'>\n\n## ğŸ“Š è®¿é—®åˆ†å¸ƒåˆ†æ\n\nåˆ†æç”¨æˆ·è®¿é—®çš„æ—¶é—´åˆ†å¸ƒï¼Œè¯†åˆ«é«˜å³°æ—¶æ®µå’Œå·¥ä½œæ¨¡å¼\n\n</div>"
            },
            "name": "text - distribution header",
            "id": "9b41475b-3cb0-40cf-ae39-cadf2e3e5e1f"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Hour = hourofday(TimeGenerated)\n| summarize \n    Connections = count(),\n    UniqueUsers = dcount(UserPrincipalName)\n    by Hour\n| union (\n    range Hour from 0 to 23 step 1\n    | extend Connections = 0, UniqueUsers = 0\n)\n| summarize \n    Connections = sum(Connections),\n    UniqueUsers = sum(UniqueUsers)\n    by Hour\n| order by Hour asc",
                "size": 0,
                "title": "24å°æ—¶åˆ†å¸ƒ - é«˜å³°æ—¶æ®µåˆ†æ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "barchart",
                "chartSettings": {
                    "xAxis": "Hour",
                    "yAxis": [
                        "Connections",
                        "UniqueUsers"
                    ],
                    "seriesLabelSettings": [
                        {
                            "seriesName": "Connections",
                            "label": "è¿æ¥æ¬¡æ•°",
                            "color": "orange"
                        },
                        {
                            "seriesName": "UniqueUsers",
                            "label": "ç‹¬ç«‹ç”¨æˆ·æ•°",
                            "color": "blue"
                        }
                    ],
                    "ySettings": {
                        "numberFormatSettings": {
                            "unit": 0,
                            "options": {
                                "style": "decimal"
                            }
                        },
                        "min": 0
                    }
                }
            },
            "customWidth": "50",
            "name": "query - hourly distribution",
            "id": "a74f4fbd-3d23-4eba-9621-013c0fe8943f"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend DayOfWeek = dayofweek(TimeGenerated)\n| extend WeekDay = case(\n    DayOfWeek == 0d, \"å‘¨æ—¥\",\n    DayOfWeek == 1d, \"å‘¨ä¸€\",\n    DayOfWeek == 2d, \"å‘¨äºŒ\",\n    DayOfWeek == 3d, \"å‘¨ä¸‰\",\n    DayOfWeek == 4d, \"å‘¨å››\",\n    DayOfWeek == 5d, \"å‘¨äº”\",\n    DayOfWeek == 6d, \"å‘¨å…­\",\n    \"æœªçŸ¥\"\n)\n| summarize Connections = count() by WeekDay, DayOfWeek\n| order by DayOfWeek asc\n| project WeekDay, Connections",
                "size": 0,
                "title": "å·¥ä½œæ—¥åˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "piechart"
            },
            "customWidth": "50",
            "name": "query - weekday distribution",
            "id": "d5ac7894-450f-4595-bf3c-89ccfc4fffd3"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background: linear-gradient(135deg, #ffe6e6 0%, #ffd4d4 100%); padding: 20px; border-left: 5px solid #d13438; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 8px rgba(209,52,56,0.1);'>\n\n## ğŸ”’ å®‰å…¨é£é™©ä¸å¼‚å¸¸è¡Œä¸ºç›‘æ§\n\nâš ï¸ å®æ—¶ç›‘æ§å®‰å…¨å‘Šè­¦ã€å¼‚å¸¸ç™»å½•ã€éå·¥ä½œæ—¶æ®µè®¿é—®å’Œæ½œåœ¨å¨èƒ\n\n</div>"
            },
            "name": "text - security header",
            "id": "7cf6132a-deeb-4463-8132-c44099f28a84"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SecurityAlert\n| where ProviderName contains \"AVD\" or ProviderName contains \"Virtual Desktop\" or AlertName contains \"Remote Desktop\"\n| summarize AlertCount = count() by bin(TimeGenerated, 1d), AlertSeverity\n| order by TimeGenerated asc",
                "size": 0,
                "title": "å®‰å…¨å‘Šè­¦è¶‹åŠ¿ (æŒ‰ä¸¥é‡ç¨‹åº¦)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "barchart",
                "chartSettings": {
                    "seriesLabelSettings": [
                        {
                            "seriesName": "High",
                            "color": "redBright"
                        },
                        {
                            "seriesName": "Medium",
                            "color": "orange"
                        },
                        {
                            "seriesName": "Low",
                            "color": "yellow"
                        }
                    ]
                }
            },
            "customWidth": "60",
            "name": "query - security alerts trend",
            "id": "b8d53f3f-a74c-4bf1-894c-0ad349f582bb"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SecurityAlert\n| where ProviderName contains \"AVD\" or ProviderName contains \"Virtual Desktop\" or AlertName contains \"Remote Desktop\"\n| summarize AlertCount = count() by AlertSeverity\n| order by AlertCount desc",
                "size": 0,
                "title": "å‘Šè­¦ä¸¥é‡ç¨‹åº¦åˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "piechart",
                "chartSettings": {
                    "seriesLabelSettings": [
                        {
                            "seriesName": "High",
                            "color": "redBright"
                        },
                        {
                            "seriesName": "Medium",
                            "color": "orange"
                        },
                        {
                            "seriesName": "Low",
                            "color": "yellow"
                        }
                    ]
                }
            },
            "customWidth": "40",
            "name": "query - alert severity distribution",
            "id": "4b1ae21c-fe21-4297-a1c1-9f6314d83709"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SecurityAlert\n| where ProviderName contains \"AVD\" or ProviderName contains \"Virtual Desktop\" or AlertName contains \"Remote Desktop\"\n| summarize \n    AlertCount = count(),\n    LastAlertTime = max(TimeGenerated),\n    Severity = max(AlertSeverity)\n    by AlertName\n| order by AlertCount desc\n| take 10",
                "size": 0,
                "title": "Top 10 å®‰å…¨å‘Šè­¦ç±»å‹",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "å‘Šè­¦æ¬¡æ•°",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "red"
                            }
                        },
                        {
                            "columnMatch": "ä¸¥é‡ç¨‹åº¦",
                            "formatter": 18,
                            "formatOptions": {
                                "thresholdsOptions": "colors",
                                "thresholdsGrid": [
                                    {
                                        "operator": "==",
                                        "thresholdValue": "High",
                                        "representation": "redBright",
                                        "text": "{0}{1}"
                                    },
                                    {
                                        "operator": "==",
                                        "thresholdValue": "Medium",
                                        "representation": "orange",
                                        "text": "{0}{1}"
                                    },
                                    {
                                        "operator": "Default",
                                        "thresholdValue": null,
                                        "representation": "yellow",
                                        "text": "{0}{1}"
                                    }
                                ]
                            }
                        }
                    ]
                }
            },
            "name": "query - top alerts",
            "id": "a8a4e089-5ae8-4d63-a4ce-d5f60fe8bfe9"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éå·¥ä½œæ—¥è®¿é—®è®°å½•ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| extend DayOfWeek = dayofweek(TimeGenerated)\n| where DayOfWeek == 0d or DayOfWeek == 6d\n| extend WeekendDay = case(\n    DayOfWeek == 0d, \"å‘¨æ—¥\",\n    DayOfWeek == 6d, \"å‘¨å…­\",\n    \"\"\n)\n| summarize \n    AccessCount = count(),\n    LastAccess = max(TimeGenerated),\n    Locations = make_set(Location)\n    by UserPrincipalName, Department, WeekendDay\n| order by AccessCount desc\n| take 20",
                "size": 0,
                "title": "âš ï¸ éå·¥ä½œæ—¥è®¿é—®è®°å½• (å‘¨æœ«ç™»å½•)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "AccessCount",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "orange"
                            }
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - weekend access",
            "id": "6b9668fb-1e50-4496-a69d-4b70cca9cf76"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// éå·¥ä½œæ—¶é—´è®¿é—®ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| extend LocationStr = tostring(Location)\n| extend TimezoneOffset = case(\n    LocationStr contains \"China\" or LocationStr contains \"Beijing\" or LocationStr contains \"Shanghai\", 8.0,\n    LocationStr contains \"Singapore\" or LocationStr contains \"Hong Kong\" or LocationStr contains \"Malaysia\", 8.0,\n    LocationStr contains \"Japan\" or LocationStr contains \"Tokyo\", 9.0,\n    LocationStr contains \"Korea\" or LocationStr contains \"Seoul\", 9.0,\n    LocationStr contains \"India\" or LocationStr contains \"Mumbai\" or LocationStr contains \"Delhi\", 5.5,\n    LocationStr contains \"Dubai\" or LocationStr contains \"UAE\", 4.0,\n    LocationStr contains \"United Kingdom\" or LocationStr contains \"London\", 0.0,\n    LocationStr contains \"Germany\" or LocationStr contains \"France\" or LocationStr contains \"Netherlands\" or LocationStr contains \"Belgium\", 1.0,\n    LocationStr contains \"United States\" or LocationStr contains \"America\", -5.0,\n    LocationStr contains \"California\" or LocationStr contains \"Los Angeles\" or LocationStr contains \"San Francisco\", -8.0,\n    LocationStr contains \"Australia\" or LocationStr contains \"Sydney\", 10.0,\n    8.0\n)\n| extend LocalTime = TimeGenerated + (TimezoneOffset * 1h)\n| extend LocalHour = hourofday(LocalTime)\n| where LocalHour < 6 or LocalHour >= 22\n| summarize \n    AccessCount = count(),\n    LatestUTC = max(TimeGenerated),\n    LatestLocal = max(LocalTime),\n    LocationName = take_any(LocationStr)\n    by UserPrincipalName, Department, IPAddress\n| project UserPrincipalName, Department, IPAddress, AccessCount, LatestUTC, LatestLocal, LocationName\n| order by AccessCount desc\n| take 20",
                "size": 0,
                "title": "ğŸŒ™ éå·¥ä½œæ—¶é—´è®¿é—® (åŸºäºç”¨æˆ·æœ¬åœ°æ—¶é—´ 22:00-06:00)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "è®¿é—®æ¬¡æ•°",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "purple"
                            }
                        },
                        {
                            "columnMatch": "è®¿é—®æ—¶æ®µ",
                            "formatter": 0,
                            "formatOptions": {
                                "customColumnWidthSetting": "25ch"
                            }
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - off hours access",
            "id": "7a69795d-83a1-47f6-b285-31fc1e0d11ca"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// å¤±è´¥çš„ç™»å½•å°è¯•ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType != 0\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize \n    FailureCount = count(),\n    LastFailureTime = max(TimeGenerated)\n    by UserPrincipalName, Department, ResultDescription, IPAddress\n| order by FailureCount desc\n| take 20",
                "size": 0,
                "title": "å¤±è´¥çš„ç™»å½•å°è¯• (æ½œåœ¨é£é™©)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "å¤±è´¥æ¬¡æ•°",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "red"
                            }
                        },
                        {
                            "columnMatch": "IPAddress",
                            "formatter": 0,
                            "formatOptions": {
                                "customColumnWidthSetting": "20ch"
                            }
                        }
                    ]
                }
            },
            "name": "query - failed logins",
            "id": "ae5352d0-5e15-4f30-b7b6-71765ad8886c"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background: linear-gradient(135deg, #e8f5e9 0%, #d4edd6 100%); padding: 20px; border-left: 5px solid #107c10; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 8px rgba(16,124,16,0.1);'>\n\n## ğŸ‘¥ ç”¨æˆ·è¡Œä¸ºä¸æ´»åŠ¨åˆ†æ\n\næ·±å…¥äº†è§£ç”¨æˆ·è®¿é—®æ¨¡å¼ã€åœ°ç†åˆ†å¸ƒã€è®¾å¤‡åå¥½å’Œå¼‚å¸¸è¡Œä¸º\n\n</div>"
            },
            "name": "text - user activity header",
            "id": "dafcad82-34ea-4c92-a580-45bb09265c20"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// Top 20 æ´»è·ƒç”¨æˆ·ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize \n    ConnectionCount = count(),\n    LastConnectionTime = max(TimeGenerated)\n    by UserPrincipalName, Department\n| order by ConnectionCount desc\n| take 20",
                "size": 0,
                "title": "Top 20 æ´»è·ƒç”¨æˆ·",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "è¿æ¥æ¬¡æ•°",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "blue"
                            }
                        },
                        {
                            "columnMatch": "å¹³å‡ä¼šè¯æ—¶é•¿",
                            "formatter": 0,
                            "numberFormat": {
                                "unit": 24,
                                "options": {
                                    "style": "decimal",
                                    "useGrouping": false
                                }
                            }
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - top users",
            "id": "18dee9f4-49af-4bb2-b114-ea7f86ffabc7"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend RawOS = tostring(DeviceDetail.operatingSystem)\n| extend ClientOS = case(\n    RawOS contains \"Windows\", \"Windows\",\n    RawOS contains \"Mac\", \"macOS\",\n    RawOS contains \"iOS\", \"iOS\",\n    RawOS contains \"Android\", \"Android\",\n    RawOS contains \"Chrome\", \"ChromeOS\",\n    RawOS contains \"Linux\", \"Linux\",\n    isnotempty(RawOS), RawOS,\n    \"Unknown\"\n)\n| where ClientOS != \"Unknown\"\n| summarize UserCount = dcount(UserPrincipalName), ConnectionCount = count() by ClientOS\n| order by ConnectionCount desc",
                "size": 0,
                "title": "å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿåˆ†å¸ƒ",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "piechart"
            },
            "customWidth": "50",
            "name": "query - client os",
            "id": "8ef9cc47-0126-48b2-ab9f-d4024c2b4de7"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// å¤šåœ°ç‚¹ç™»å½•ç”¨æˆ·ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize \n    Locations = dcount(Location),\n    Cities = make_set(Location),\n    TotalLogins = count()\n    by UserPrincipalName, Department\n| where Locations >= 3\n| order by Locations desc\n| take 15",
                "size": 0,
                "title": "ğŸŒ å¤šåœ°ç‚¹ç™»å½•ç”¨æˆ· (ä½ç½®å˜åŒ–é¢‘ç¹)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "Locations",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "blue"
                            }
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - multi location users",
            "id": "f32c8429-6d17-49c5-8c95-611e954e9fd5"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where isnotempty(Location)\n| summarize SigninCount = count(), UniqueUsers = dcount(UserPrincipalName) by Location\n| order by SigninCount desc\n| take 15",
                "size": 0,
                "title": "ç”¨æˆ·åœ°ç†ä½ç½®åˆ†å¸ƒ (Top 15)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "map",
                "mapSettings": {
                    "locInfo": "CountryRegion",
                    "locInfoColumn": "Location",
                    "sizeSettings": "SigninCount",
                    "sizeAggregation": "Sum",
                    "legendMetric": "SigninCount",
                    "legendAggregation": "Sum",
                    "itemColorSettings": {
                        "nodeColorField": "SigninCount",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                    }
                }
            },
            "name": "query - user locations",
            "id": "99a72481-2ae8-4fcb-a12c-f6d1ee387fb7"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background-color: #f3e5f5; padding: 15px; border-left: 5px solid #8e44ad; border-radius: 5px; margin: 20px 0;'>\n\n## ğŸ’» è®¿é—®è®¾å¤‡åˆ†ç±»\n\nåŒºåˆ†**å…¬å¸ç®¡ç†è®¾å¤‡**ï¼ˆIntune ç®¡ç†ï¼‰å’Œ **BYOD è®¾å¤‡**ï¼ˆä¸ªäººè®¾å¤‡ï¼‰ï¼Œç›‘æ§è®¾å¤‡å®‰å…¨çŠ¶æ€ã€‚\n\n</div>"
            },
            "name": "text - device header",
            "id": "2a2baace-899d-46f7-8f37-1a69b0a49694"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Browser = tostring(DeviceDetail.browser)\n| where isnotempty(Browser)\n| summarize \n    ConnectionCount = count(),\n    UniqueUsers = dcount(UserPrincipalName)\n    by Browser\n| order by ConnectionCount desc\n| take 10",
                "size": 0,
                "title": "æµè§ˆå™¨ä½¿ç”¨ç»Ÿè®¡ (Top 10)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "è¿æ¥æ¬¡æ•°",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "blue"
                            }
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - browsers",
            "id": "180d9e8f-1320-49bb-808d-1162b8630644"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// åŒºåˆ†å…¬å¸ç®¡ç†è®¾å¤‡ï¼ˆIntuneï¼‰å’Œ BYOD è®¾å¤‡\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend \n    IsCompliant = tobool(DeviceDetail.isCompliant),\n    IsManaged = tobool(DeviceDetail.isManaged),\n    TrustType = tostring(DeviceDetail.trustType)\n| extend DeviceCategory = case(\n    IsManaged == true and IsCompliant == true, \"ğŸŸ¢ å…¬å¸ç®¡ç†è®¾å¤‡ï¼ˆåˆè§„ï¼‰\",\n    IsManaged == true and IsCompliant != true, \"ğŸŸ¡ å…¬å¸ç®¡ç†è®¾å¤‡ï¼ˆä¸åˆè§„ï¼‰\",\n    IsManaged == true, \"ğŸŸ¢ å…¬å¸ç®¡ç†è®¾å¤‡\",\n    IsCompliant == true, \"ğŸŸ  BYOD è®¾å¤‡ï¼ˆåˆè§„ï¼‰\",\n    IsCompliant == false, \"ğŸ”´ BYOD è®¾å¤‡ï¼ˆä¸åˆè§„ï¼‰\",\n    \"âšª BYOD è®¾å¤‡ï¼ˆæœªçŸ¥ï¼‰\"\n)\n| summarize \n    ConnectionCount = count(), \n    UserCount = dcount(UserPrincipalName)\n    by DeviceCategory\n| order by ConnectionCount desc",
                "size": 0,
                "title": "è®¾å¤‡åˆ†ç±»ï¼šå…¬å¸ç®¡ç† vs BYOD",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "piechart",
                "chartSettings": {
                    "seriesLabelSettings": [
                        {
                            "seriesName": "ğŸŸ¢ å…¬å¸ç®¡ç†è®¾å¤‡ï¼ˆåˆè§„ï¼‰",
                            "color": "green"
                        },
                        {
                            "seriesName": "ğŸŸ¡ å…¬å¸ç®¡ç†è®¾å¤‡ï¼ˆä¸åˆè§„ï¼‰",
                            "color": "yellow"
                        },
                        {
                            "seriesName": "ğŸŸ¢ å…¬å¸ç®¡ç†è®¾å¤‡",
                            "color": "greenDark"
                        },
                        {
                            "seriesName": "ğŸŸ  BYOD è®¾å¤‡ï¼ˆåˆè§„ï¼‰",
                            "color": "orange"
                        },
                        {
                            "seriesName": "ğŸ”´ BYOD è®¾å¤‡ï¼ˆä¸åˆè§„ï¼‰",
                            "color": "red"
                        },
                        {
                            "seriesName": "âšª BYOD è®¾å¤‡ï¼ˆæœªçŸ¥ï¼‰",
                            "color": "gray"
                        }
                    ]
                }
            },
            "customWidth": "50",
            "name": "query - device compliance",
            "id": "677cae9a-45e5-40ca-86db-5b17e4c0b90f"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background-color: #fff3cd; padding: 15px; border-left: 5px solid #ff6b35; border-radius: 5px; margin: 20px 0;'>\n\n## ğŸ” å¼‚å¸¸æ£€æµ‹\n\nğŸ¯ åŸºäºç»Ÿè®¡åˆ†æè¯†åˆ«å¼‚å¸¸è¡Œä¸ºå’Œå¯ç–‘æ´»åŠ¨\n\n</div>"
            },
            "name": "text - anomaly header",
            "id": "239fb2de-83d9-447a-8707-835017bb9060"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "// å¼‚å¸¸æ´»è·ƒç”¨æˆ·ï¼ˆå«éƒ¨é—¨ä¿¡æ¯ï¼‰\nlet GetDepartment = (upn: string) {\n    let emailPrefix = tostring(split(upn, \"@\")[0]);\n    case(\n        emailPrefix contains \"hr\" or emailPrefix contains \"äººåŠ›\", \"äººåŠ›èµ„æºéƒ¨\",\n        emailPrefix contains \"it\" or emailPrefix contains \"tech\", \"ITéƒ¨\",\n        emailPrefix contains \"sales\" or emailPrefix contains \"é”€å”®\", \"é”€å”®éƒ¨\",\n        emailPrefix contains \"finance\" or emailPrefix contains \"è´¢åŠ¡\", \"è´¢åŠ¡éƒ¨\",\n        emailPrefix contains \"marketing\" or emailPrefix contains \"å¸‚åœº\", \"å¸‚åœºéƒ¨\",\n        emailPrefix contains \"ops\" or emailPrefix contains \"è¿è¥\", \"è¿è¥éƒ¨\",\n        \"å…¶ä»–éƒ¨é—¨\"\n    )\n};\nSigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where ResultType == 0\n| extend Department = GetDepartment(UserPrincipalName)\n| summarize DailyConnections = count() by UserPrincipalName, Department, bin(TimeGenerated, 1d)\n| summarize \n    TotalConnections = sum(DailyConnections),\n    AvgDailyConnections = avg(DailyConnections),\n    MaxDailyConnections = max(DailyConnections),\n    StdDev = stdev(DailyConnections)\n    by UserPrincipalName, Department\n| extend AnomalyScore = round((MaxDailyConnections - AvgDailyConnections) / StdDev, 2)\n| where AnomalyScore >= 2\n| project UserPrincipalName, Department, TotalConnections, AvgDailyConnections = round(AvgDailyConnections, 2), MaxDailyConnections, AnomalyScore\n| order by AnomalyScore desc\n| take 10",
                "size": 0,
                "title": "å¼‚å¸¸æ´»è·ƒç”¨æˆ· (åŸºäºç»Ÿè®¡åˆ†æ)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "å¼‚å¸¸ç¨‹åº¦",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "red"
                            }
                        }
                    ]
                }
            },
            "customWidth": "60",
            "name": "query - anomaly users",
            "id": "2711fdcf-03ad-4063-be71-e162cee0ff9a"
        },
        {
            "type": 3,
            "content": {
                "version": "KqlItem/1.0",
                "query": "SigninLogs\n| where AppDisplayName in (\"Azure Virtual Desktop Client\", \"Windows Virtual Desktop Client\")\n| where isnotempty(IPAddress)\n| summarize \n    LoginCount = count(),\n    Users = make_set(UserPrincipalName),\n    UniqueUsers = dcount(UserPrincipalName)\n    by IPAddress\n| where UniqueUsers >= 3\n| order by UniqueUsers desc\n| take 10\n| project IPAddress, UniqueUsers, LoginCount",
                "size": 0,
                "title": "å¯ç–‘ IP åœ°å€ (å¤šç”¨æˆ·å…±äº«)",
                "timeContext": {
                    "durationMs": 0
                },
                "timeContextFromParameter": "TimeRange",
                "queryType": 0,
                "resourceType": "microsoft.operationalinsights/workspaces",
                "crossComponentResources": [
                    "{Workspace}"
                ],
                "visualization": "table",
                "gridSettings": {
                    "formatters": [
                        {
                            "columnMatch": "ç”¨æˆ·æ•°é‡",
                            "formatter": 8,
                            "formatOptions": {
                                "palette": "orange"
                            }
                        }
                    ]
                }
            },
            "customWidth": "40",
            "name": "query - suspicious ips",
            "id": "296989b6-1c3e-401f-bf26-1c1c16c78911"
        },
        {
            "type": 1,
            "content": {
                "json": "<div style='background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #dee2e6; margin-top: 30px;'>\n\n### ğŸ“ å·¥ä½œç°¿è¯´æ˜\n\n<div style='background-color: white; padding: 15px; border-radius: 5px; margin: 10px 0;'>\n\n#### ğŸ“Š æ•°æ®æº\n- **SigninLogs**: Entra ID ç™»å½•æ—¥å¿—ï¼ˆä¸»è¦æ•°æ®æºï¼‰\n  - åº”ç”¨è¿‡æ»¤: `Azure Virtual Desktop Client` / `Windows Virtual Desktop Client`\n  - æˆåŠŸç™»å½•: `ResultType == 0` | å¤±è´¥ç™»å½•: `ResultType != 0`\n  - åŒ…å«è®¾å¤‡ä¿¡æ¯ï¼šæ“ä½œç³»ç»Ÿã€æµè§ˆå™¨ã€åˆè§„çŠ¶æ€ã€ç®¡ç†çŠ¶æ€\n- **SecurityAlert**: å®‰å…¨å‘Šè­¦ï¼ˆè¾…åŠ©æ•°æ®æºï¼‰\n\n**ğŸ“ éƒ¨é—¨è¯†åˆ«ï¼š** é€šè¿‡é‚®ç®±å‰ç¼€å…³é”®å­—è¯†åˆ«ï¼ˆå¦‚ï¼šhrâ†’äººåŠ›èµ„æºéƒ¨ï¼Œitâ†’ITéƒ¨ï¼Œsalesâ†’é”€å”®éƒ¨ï¼‰\n\n</div>\n\n<div style='background-color: white; padding: 15px; border-radius: 5px; margin: 10px 0;'>\n\n#### ğŸ”‘ å…³é”®å­—æ®µ\n- `UserPrincipalName`: ç”¨æˆ·ä¸»ä½“åç§°\n- `Department`: éƒ¨é—¨ï¼ˆä»é‚®ç®±å‰ç¼€æ¨æ–­ï¼‰\n- `IPAddress`: ç™»å½•æº IP\n- `Location`: åœ°ç†ä½ç½®\n- `DeviceDetail`: è®¾å¤‡ä¿¡æ¯ï¼ˆOSã€æµè§ˆå™¨ã€åˆè§„çŠ¶æ€ï¼‰\n- `ResultType`: ç™»å½•ç»“æœ\n\n</div>\n\n<div style='background-color: #d1ecf1; padding: 15px; border-radius: 5px; border-left: 4px solid #0c5460; margin: 10px 0;'>\n\n#### ğŸ’¡ å»ºè®®æ“ä½œ\n1. ğŸ¢ **éƒ¨é—¨åˆ†æ**ï¼šå®šæœŸæ£€æŸ¥å„éƒ¨é—¨çš„ AVD ä½¿ç”¨æƒ…å†µå’Œå®‰å…¨é£é™©è¯„åˆ†\n2. âš ï¸ **å®‰å…¨ç›‘æ§**ï¼šå…³æ³¨é«˜é£é™©éƒ¨é—¨ã€å¼‚å¸¸æ´»è·ƒç”¨æˆ·å’Œå¯ç–‘ IP åœ°å€\n3. ğŸ” **åˆè§„ç®¡ç†**ï¼šç›‘æ§éƒ¨é—¨è®¾å¤‡åˆè§„ç‡ï¼Œç¡®ä¿ç¬¦åˆä¼ä¸šå®‰å…¨ç­–ç•¥\n4. ğŸ“ˆ **è¶‹åŠ¿åˆ†æ**ï¼šäº†è§£å„éƒ¨é—¨è®¿é—®æ¨¡å¼ã€é«˜å³°æ—¶æ®µå’Œèµ„æºéœ€æ±‚\n5. ğŸ’» **è®¾å¤‡ç®¡ç†**ï¼šæ£€æŸ¥è®¾å¤‡åˆè§„çŠ¶æ€å’Œç®¡ç†æƒ…å†µ\n6. ğŸŒ **åœ°ç†åˆ†å¸ƒ**ï¼šåˆ†æéƒ¨é—¨ç”¨æˆ·çš„åœ°ç†ä½ç½®ï¼Œè¯†åˆ«å¼‚å¸¸è®¿é—®\n\n**ğŸ›¡ï¸ è®¾å¤‡åˆè§„æ€§è¯´æ˜ï¼š** æ£€æµ‹ç”¨æˆ·è®¿é—® AVD çš„ç‰©ç†ç»ˆç«¯è®¾å¤‡ï¼ˆç¬”è®°æœ¬ã€æ‰‹æœºç­‰ï¼‰ï¼Œè€Œé AVD è™šæ‹Ÿæœºæœ¬èº«ã€‚\n\n</div>\n\n<div style='background-color: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;'>\n\n**â±ï¸ æ•°æ®åˆ·æ–°ï¼š** å»ºè®®æ¯ 1-4 å°æ—¶åˆ·æ–°ï¼ˆSigninLogs å»¶è¿Ÿ 5-15 åˆ†é’Ÿï¼‰\n\n</div>\n\n<div style='background-color: #e9ecef; padding: 10px; border-radius: 5px; margin: 20px 0 0 0; text-align: center; border-top: 2px solid #dee2e6;'>\n\nÂ© 2025 Jason Liang. All Rights Reserved. | ç‰ˆæœ¬: 2.0 (å¢å¼ºéƒ¨é—¨åˆ†æ)\n\n</div>\n\n</div>"
            },
            "name": "text - footer",
            "id": "6f12caea-5379-466c-8c9e-759217e0a683"
        }
    ],
    "fallbackResourceIds": [
        "/subscriptions/39c4d6ba-bd22-45fa-abbc-bd025e035ae5/resourcegroups/sentinel/providers/microsoft.operationalinsights/workspaces/sentinel"
    ],
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json",
    "context": {
        "ownerId": "/subscriptions/39c4d6ba-bd22-45fa-abbc-bd025e035ae5/resourcegroups/sentinel/providers/microsoft.operationalinsights/workspaces/sentinel"
    }
}
